<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Darío Macchi | JQuery append into heavy loaded DOM trees</title>

    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Darío Macchi" />
<meta name="description" content="My own resume in an uncommon way to present it that I called KanbanCV. Just as a regular resume but with additional (complementary) information." />
<meta name="keywords" content="kanbancv,resume,kanban,curriculum vitae,me,experience,education,research,projects,software engineer,PwC,InnovaAge,Universidad ORT Uruguay" />

<link rel="dns-prefetch" href="//dariomac.com"/>
<link rel="dns-prefetch" href="//translate.googleapis.com"/>
<link rel="dns-prefetch" href="//gstatic.com"/>
<link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com"/>
<link rel="dns-prefetch" href="//google-analytics.com"/>
<link rel="dns-prefetch" href="//fonts.gstatic.com"/>
<link rel="dns-prefetch" href="//translate.google.com"/>
<link rel="dns-prefetch" href="//google.com"/>
<link rel="dns-prefetch" href="//c.statcounter.com"/>
<link rel="dns-prefetch" href="//statcounter.com"/>
<link rel="dns-prefetch" href="//fonts.googleapis.com"/>
<link rel="dns-prefetch" href="//yui.yahooapis.com"/>

<link rel="stylesheet" type="text/css" href="/assets/vendor/jquery.fancybox/jquery.fancybox.css">
<link rel="stylesheet" type="text/css" href="/assets/css/style.css">

<link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans' type='text/css'>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css" type='text/css'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!--[if lt IE 8]>
  <link rel="stylesheet" type="text/css" href="/assets/css/style_ie.css">
  <script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<![endif]-->

<!-- <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
<script type="text/javascript" src="/assets/vendor/jquery/jquery.min.js"></script>
<!--<script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>-->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-28220054-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  function afterContentDraw(){
    setTimeout(function(){
      var aList = $('a').not('a[href^="/"]').not('a[href*="www.dariomac.com"]').not('a[href*="javascript:void(0)"]');
      aList = aList.add($('a[href$=".pdf"],a[href$=".zip"],a[href$=".txt"]'));
      $.each(aList,
        function(k, v){
          var $v = $(v);

          $v.click(function(){
            _gaq.push(['_trackPageview', $v.attr('href')]);
          });
            //$v.css('color','red');
          });

      preloadImages($('a.fancybox'));
    }, 1000);
  }

  function preloadImages(array) {
    if (!preloadImages.list) {
      preloadImages.list = [];
    }
    for (var i = 0; i < array.length; i++) {
      var img = new Image();
      img.src = $(array[i]).attr('href');
      preloadImages.list.push(img);
    }
  }

  function loadCSS( href, before, media ){
    // Arguments explained:
    // `href` [REQUIRED] is the URL for your CSS file.
    // `before` [OPTIONAL] is the element the script should use as a reference for injecting our stylesheet <link> before
      // By default, loadCSS attempts to inject the link after the last stylesheet or script in the DOM. However, you might desire a more specific location in your document.
    // `media` [OPTIONAL] is the media type or query of the stylesheet. By default it will be 'all'
    var doc = this.document;
    var ss = doc.createElement( "link" );
    var newMedia = media || "all";
    var ref;
    if( before ){
      ref = before;
    }
    else {
      var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
      ref = refs[ refs.length - 1];
    }

    var sheets = doc.styleSheets;
    ss.rel = "stylesheet";
    ss.href = href;
    // temporarily set media to something inapplicable to ensure it'll fetch without blocking render
    ss.media = "only x";

    // wait until body is defined before injecting link. This ensures a non-blocking load in IE11.
    function ready( cb ){
      if( doc.body ){
        return cb();
      }
      setTimeout(function(){
        ready( cb );
      });
    }
    // Inject link
      // Note: the ternary preserves the existing behavior of "before" argument, but we could choose to change the argument to "after" in a later release and standardize on ref.nextSibling for all refs
      // Note: `insertBefore` is used instead of `appendChild`, for safety re: http://www.paulirish.com/2011/surefire-dom-element-insertion/
    ready( function(){
      ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
    });
    // A method (exposed on return object for external use) that mimics onload by polling until document.styleSheets until it includes the new sheet.
    var onloadcssdefined = function( cb ){
      var resolvedHref = ss.href;
      var i = sheets.length;
      while( i-- ){
        if( sheets[ i ].href === resolvedHref ){
          return cb();
        }
      }
      setTimeout(function() {
        onloadcssdefined( cb );
      });
    };

    // once loaded, set link's media back to `all` so that the stylesheet applies once it loads
    if( ss.addEventListener ){
      ss.addEventListener( "load", function(){
        this.media = newMedia;
      });
    }
    ss.onloadcssdefined = onloadcssdefined;
    onloadcssdefined(function() {
      if( ss.media !== newMedia ){
        ss.media = newMedia;
      }
    });
    return ss;
  };
</script>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
  var sc_project=9186547;
  var sc_invisible=1;
  var sc_security="dce954c9";
  var scJsHost = (("https:" == document.location.protocol) ?
    "https://secure." : "http://www.");
  document.write("<sc"+"ript type='text/javascript' src='" +
    scJsHost+
    "statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript>
  <div class="statcounter">
    <a title="web analytics" href="http://statcounter.com/" target="_blank">
      <img class="statcounter" src="http://c.statcounter.com/9186547/0/dce954c9/1/" alt="web analytics"></a>
  </div>
</noscript>
<!-- End of StatCounter Code for Default Guide -->

<script type="text/javascript">
  var baseUrl = "http://www.dariomac.com";
</script>

<link rel="shortcut icon" href="/assets/favicon.ico" />

<link href="https://plus.google.com/101333970265292795022" rel="publisher" />

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta property="og:image" content="/assets/images/d_social.png">
<meta property="og:image:type" content="image/png">


    <script type="text/javascript" src="/assets/vendor/jquery.fancybox/jquery.fancybox.pack.js"></script>
    <script type="text/javascript" src="/assets/js/kanbancv.js"></script>

    <script type="text/javascript">
      $(function() {
        //board_dimensions.init(); //draw_kanban_board(boardArray, false, tasksArray, false);
        afterContentDraw();

        $(".fancybox").fancybox({
          openEffect  : 'none',
          closeEffect : 'none'
        });
      });
    </script>

  </head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <div class="wrapper">
      <div class="header">
        <div class="center"></div>
      </div>
      <div class="board_view">
        <div class="clearfix top_menu" style="border-bottom: #D8D7D7 1px solid">
  <a href="/">
    <img style="float:left;" width="50" height="50" src="/assets/images/d.png" alt="Orange D inside a circle">
  </a>
  <div style="float:right; padding-top: 8px;">
      <a class="btn_feedback" title="Contact me" href="/messages/new">
      <strong>Contact me<span>&nbsp;</span></strong>
      </a>
  </div>
  <div class="submenu">
    <div class="orange_box" itemprop="author" itemscope itemtype="http://schema.org/Person">
      <a class="url" href="/about-me">
          <div class="username">
              <span>
                <strong>
                  <span itemprop="name">Darío</span> <span itemprop="familyName">Macchi</span>
                </strong>
              </span>
          </div>
      </a>
      <ul>
        <li id="geo">
          <strong>
            <span itemscope itemtype="http://schema.org/City">
              <a target="_blank" href="http://maps.google.com/maps?q=montevideo+city+uruguay&hl=en&sll=-32.522779,-55.765835&sspn=5.325828,9.876709&t=v&hnear=Montevideo,+Montevideo+Dept,+Uruguay&z=11" itemprop="url">
                <span itemprop="name">
                  Montevideo</span>,
              </a>
            </span>
            <span itemprop="nationality" itemscope itemtype="http://schema.org/Country">
              <span itemprop="name">
                <a href="https://www.google.com.uy/maps/preview?q=google+maps+uruguay&ie=UTF-8&hq=&hnear=0x9575073afb5fde09:0x4a5596616016524a,Uruguay&gl=uy&ei=KiKjU6fpE-HNsQSlqYGoCg&ved=0CBsQ8gEwAA" itemprop="url">
                  Uruguay
                </a>
              </span>
            </span>
          </strong>
        </li>
        <li id="common_cv"><strong><a href="/kanbancv" style="color:#FFF">What is this?</a></strong></li>
      </ul>
    </div>
  </div>

  <div class="breadcrumb">
    <div class="breadcrumb-items" itemprop="breadcrumb">
      <strong><a href="/">Home ( KanbanCV ) / </a></strong>
        <strong></strong>
      <div style="padding-left: 20px; display: inline;">
        <div id="new_essay" style="display: inline; color:red;">
          <span class="transition">
            <i class="fa fa-heartbeat" aria-hidden="true"></i>
            <a href='/first-two-weeks-rest-flow-e-life' style='text-decoration: underline;'>
              The First Two Weeks Of The Rest Of My Flow-e Life
            </a>
          </span>
          |
          <a href="/essays" style="text-decoration: underline; padding: 1px 2px;">More essays</a>
        </div>
      </div>
    </div>
  </div>
</div>

        <div id="board_container">
            <script type="text/javascript" src="/assets/vendor/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="/assets/vendor/syntaxhighlighter/shAutoloader.js"></script>
<script type="text/javascript" src="/assets/vendor/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript">
$(function() {
 SyntaxHighlighter.all();
 $('.date').html($('.date').html().split(' ')[0]);
});
</script>
<link type="text/css" rel="stylesheet" href="/assets/vendor/syntaxhighlighter/shThemeDefault.css" />

          <div class="content document">
          <h1>JQuery append into heavy loaded DOM trees</h1>
          <div>
            <p class="date">2014-04-14</p>
          </div>
          <div class="description">Describe odd behaviour when you append DOM element into heavy loaded DOM tree</div>
          <p>Last week we have found an odd behaviour in some website that drove us crazy for a while. The bug was related with the append of jQuery that is used to insert content to the end of the matched elements and the height method used to get the computed height of an element. Look at this code:</p>
<pre class="brush: javascript; toolbar: false;">
//divSong is created with jQuery, added to the (DOM) in the next line
$('.song-list .songs').append(divSong);
currentPlaying.css('height', divSong.height());
</pre>
<p>This piece of code normally works without any problem, or should work, because In our case randomly the computed height of the dynamic div (divSong) returns 0px. It seems like the append sometimes behave asynchronously, so when we ask for the divs height it is still 0px due to the fact that it hasn't been added to the DOM tree yet. To test this we code the following workaround:</p>
<pre class="brush: javascript; toolbar: false;">
//divSong is a div created using jQuery added to the DOM in the next line
$('.song-list .songs').append(divSong);
// Although JS is single thread, setTimeout lets the browser re-render the page after running the
// height code.
setTimeout(function(){
    currentPlaying.css('height', divSong.height());
}, 0);
</pre>
<p>Because in Vairix we have an “always look for evidence&quot; culture we made a search looking for something that supports (or not) this theory. We have found that many people reports similar situations, although most of them were related with other problems like asynchronous ajax callbacks or other environmental errors. Besides those false positive results, we found two questions in StackOverflow (<a href="http://www.google.com/url?q=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F5017923%2Fdiv-width-immediately-after-append-is-calculating-wrong&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHCjQ70kysaH3Bu04VtKaQsOJ41Fw">link1</a>, <a href="http://www.google.com/url?q=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F6132141%2Fjquery-why-does-width-sometimes-return-0-after-inserting-elements-with-html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHelN_XY-QE0yf0KbANE4WI0UTt6Q">link2</a>) that describe the same situation that we have. Both answers lead to the same solution as we had found (we rocks!).</p>
<p>Remember: this solutions works, but it is not due to the fact of running in a different thread (JavaScript runs in a single thread); it is because setTimeout let the browser continue with the next execution block in the queue that is the html render one.</p>

            <h2 id="Acknowledgments">Acknowledgments</h2>
              <p><a href="http://www.vairix.com/blog/jquery-append-into-heavy-loaded-dom-trees">This post</a> was written for Vairix Software Development, so I want say thanks to them for let me share this with you in my homepage.</p>

            <br>
            <h2>Significant Revisions</h2>
            <p><em>Apr 14, 2014</em>: Original Publication on vairix.com and dariomac.com</p>

            <br>


        </div>
        </div>
      </div>
    </div>
    <div class="footer" style="text-align:center; width:100%;">
  <div style="text-align:center; width:100%">
  <ul>
    <li style="margin-top: 0px;">
      <a href="javascript:void(0);" onclick="window.open('http://www.copyscape.com/?q=' + escape(window.location) + '&src=front'); return false;">
        <IMG src="/assets/images/cs-wh-3d-234x16.gif" alt="Protected by Copyscape Duplicate Content Detector" title="Protected by Copyscape Plagiarism Checker - Do not copy content from this page." width="234" height="16" border="0">
      </A>
    </li>
    <li><a style="padding-top:1px" href="/kanbancv">KanbanCV</a> © 2011-<%= Time.now.year %> <a style="padding-top:1px" href="/sitemap"><i class="fa fa-sitemap" aria-hidden="true"></i> Sitemap</a></li>
    <li>
      <a href="http://uy.linkedin.com/in/dariomac" style="text-decoration:none;" target="_blank">
        <img src="/assets/images/linkedin.png" width="17" height="16" alt="View Darío Macchi's LinkedIn profile" border="0" />
      </a>
    </li>
    <li>
      <a rel="author" href="https://plus.google.com/101333970265292795022?prsrc=3" style="text-decoration:none;" target="_blank">
        <img src="/assets/images/gplus-16.png" alt="View Darío Macchi's Google+ profile" width="15" height="15" style="border:0;"/>
      </a>
    </li>
    <li>
      <a href="http://twitter.com/_dariomac" target="_blank">
        <img src="/assets//images/twitter-16.png" width="15" height="15" alt="View my twitter"/>
      </a>
    </li>
    <li>
      <a href="http://www.researchgate.net/profile/Dario_Macchi/" target="_blank">
        <img src="/assets/images/researchgate.png" width="15" height="15" alt="View my ResearchGate profile"/>
      </a>
    </li>
    <li style="padding-right: 2px;">
      <a href="http://www.diigo.com/user/Dariomac" target="_blank">
        <img src="/assets/images/diigo.png" width="41" height="15" alt="View my Diigo bookmarks library"/>
      </a>
    </li>
    <li style="margin-top: 0px;">
      <div class="board_filter">
      <span>Filter: </span>
      <input id="filter" type="text" />
      </div>
    </li>
    <li style="margin-top: 0px">
      <a href="http://humanstxt.org/humans/dario-macchi/" target="_black">
        <img src="/assets/images/humanstxt-transparent-color.png" width="84" height="15" />
      </a>
    </li>
    <li>Powered by <a style="padding-top:1px" href="http://github.com/comfy/comfortable-mexican-sofa">Comfy</a></li>
  </ul>
  </div>
</div>

<script>
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      multilanguagePage: true,
      gaTrack: true,
      gaId: 'UA-28220054-1',
      floatPosition: google.translate.TranslateElement.FloatPosition.BOTTOM_LEFT
    });
  }
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


  </body>
</html>
